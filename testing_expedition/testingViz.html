<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Geological Timeline</title>
  <style>
    .timeline {
      position: relative;
      height: 900px; /* Increased height for better visibility */
      border-top: 1px solid black;
    }
    .event {
      position: absolute;
      background-color: lightblue;
      border: 1px solid #ddd;
      padding: 5px;
      border-radius: 5px;
      text-align: center;
    }
    .x-axis text {
      font-size: 10px;
      text-anchor: middle;
    }
    .y-axis text {
      font-size: 10px;
    }
  </style>
</head>
<body>
  <div id="timeline" class="timeline"></div>

  <script src="https://d3js.org/d3.v7.min.js"></script>
  <script>
    // Define geological periods and their time ranges with systems
    const geologicalPeriods = {
      "Cenozoic": { start: -65, end: 0, systems: { "Recent": 0, "Pleistocene": -2.6, "Holocene": -0.01 } },
      "Mesozoic": { start: -252, end: -65, systems: { "Cretaceous": -145, "Jurassic": -201, "Triassic": -252 } },
      "Paleozoic": { start: -541, end: -252, systems: { "Permian": -299, "Carboniferous": -359, "Devonian": -419, "Silurian": -443, "Ordovician": -485, "Cambrian": -541 } }
    };

    // Load the data from data.json
    d3.json("data.json").then(data => {
      console.log('Data loaded:', data); // Log the data to verify it's loaded

      const timelineWidth = 1200; // Increased width for better spacing
      const timelineHeight = 900; // Increased height
      const pointRadius = 5; // Larger point radius for visibility
      const padding = 50; // Increased padding for better visibility

      // Create the SVG container
      const svg = d3.select("#timeline").append("svg")
        .attr("width", timelineWidth)
        .attr("height", timelineHeight);

      // Create a scale for the x-axis
      const xScale = d3.scaleLinear()
        .domain([-541, 0]) // This covers the geological periods
        .range([padding, timelineWidth - padding]);

      // Define the x-axis ticks
      const xTicks = [];
      Object.values(geologicalPeriods).forEach(p => {
        if (p.start != null) xTicks.push(p.start);
        if (p.end != null) xTicks.push(p.end);
        Object.values(p.systems || {}).forEach(s => xTicks.push(s));
      });

      // Create the x-axis
      const xAxis = d3.axisBottom(xScale)
        .tickValues([...new Set(xTicks)])
        .tickFormat(d => {
          for (const [era, period] of Object.entries(geologicalPeriods)) {
            if (d >= period.start && d <= period.end) {
              const system = Object.keys(period.systems || {}).find(s => period.systems[s] === d);
              if (system) return `${system}`;
              return `${era}`;
            }
          }
          return '';
        })
        .tickSize(-timelineHeight + 2 * padding); // Extend the tick lines

      svg.append("g")
        .attr("class", "x-axis")
        .attr("transform", `translate(0, ${timelineHeight - padding})`)
        .call(xAxis);

      svg.selectAll(".x-axis text")
        .attr("dy", "1.2em")
        .attr("text-anchor", "middle");

      // Create points on the timeline
      data.forEach((item, index) => {
        const era = item.geoAgeEra;
        const system = item.geoAgeSystem;
        const eraPeriod = geologicalPeriods[era];
        const systemTime = eraPeriod ? eraPeriod.systems[system] : null;
        const xPosition = systemTime !== null ? xScale(systemTime) : (eraPeriod ? xScale(eraPeriod.start) : xScale(0));
        const yPosition = (index + 1) * (timelineHeight - 2 * padding) / (data.length + 1); // Evenly distribute y positions

        console.log(`Drawing point for ${item.title} at position (${xPosition}, ${yPosition})`); // Log position

        svg.append("circle")
          .attr("cx", xPosition)
          .attr("cy", yPosition)
          .attr("r", pointRadius)
          .attr("fill", "blue")
          .attr("stroke", "black");

        svg.append("text")
          .attr("x", xPosition + 10)
          .attr("y", yPosition + 4)
          .text(`${item.title} (${era}, ${system})`)
          .attr("font-size", "10px")
          .attr("fill", "black");
      });
    }).catch(error => {
      console.error('Error loading the data:', error);
    });
  </script>
</body>
</html>
